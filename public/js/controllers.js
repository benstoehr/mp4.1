var mp4Controllers=angular.module("mp4Controllers",[]);mp4Controllers.controller("UserController",["$scope","CommonData","$http","$window",function($scope,CommonData,$http,$window){$scope.data="",$scope.displayText="",$scope.id="",$scope.setUsers=function(){$scope.displayText="Data set"},$scope.getUsers=function(){},CommonData.getUsers(function(data){$scope.data=data,$scope.id=data._id}),$scope.tasklist="",$scope.removeUser=function(userID){CommonData.getPendingTasksForUser(userID,function(data){for($scope.tasklist=data,console.log("removeUser():: $scope.tasklist:"),console.log($scope.tasklist),i=0;i<$scope.tasklist.length;i++)CommonData.unassignTask($scope.tasklist[i]._id);CommonData.removeSingleUser(userID)}),$scope.refresh()},$scope.refresh=function(){setTimeout(function(){CommonData.getUsers(function(data){$scope.data=data,$scope.id=data._id})},1e3)}}]),mp4Controllers.controller("addUserController",["$scope","$http","$window","CommonData",function($scope,$http,$window,CommonData){$scope.name="",$scope.validname="",$scope.$watch("name",function(){var tempData="";$http({method:"GET",url:$window.sessionStorage.baseurl+"/users?where={'name':'"+$scope.name+"'}"}).then(function(response){tempData=response.data,1===tempData.data.length?($("#validname").removeClass("green").addClass("red"),$scope.validname="This name is taken, please choose another."):($("#validname").removeClass("red").addClass("green"),$scope.validname="")},function(response){console.log("THERE WAS AN ERROR!")})}),$scope.email="",$scope.validemail="",$scope.$watch("email",function(){var tempData="";$http({method:"GET",url:$window.sessionStorage.baseurl+"/users?where={'email':'"+$scope.email+"'}"}).then(function(response){tempData=response.data,1===tempData.data.length?($("#validemail").removeClass("green").addClass("red"),$scope.validemail="This email is taken, please choose another."):($("#validemail").removeClass("red").addClass("green"),$scope.validemail="")},function(response){console.log("THERE WAS AN ERROR!")})}),$scope.showNewUser=!1,$scope.newUserData="",$scope.nudName="",$scope.nudEmail="",$scope.nudID="",$scope.newUser=function(){console.log("Name:"+$scope.name+", Email:"+$scope.email),CommonData.addUser($scope.name,$scope.email,function(data){$scope.newUserData=data,console.log("newUser():: newUserData:"),console.log($scope.newUserData),$scope.nudName=$scope.newUserData.data.name,$scope.nudEmail=$scope.newUserData.data.email,$scope.nudID=$scope.newUserData.data._id,$scope.showNewUser=!0}),$scope.name="",$scope.email=""}}]),mp4Controllers.controller("userDetailController",["$scope","$http","CommonData","$routeParams",function($scope,$http,CommonData,$routeParams){$scope.data="",$scope.name="",$scope.email="",$scope.pendingTasklist="",$scope.completedTasklist="",$scope.userName="",$scope.userID="",CommonData.getSingleUser($routeParams.id,function(data){$scope.data=data,$scope.userName=$scope.data.name,$scope.userID=$scope.data._id,$scope.getTasks()}),$scope.getTasks=function(){console.log("$scope.getTasks()"),CommonData.getPendingTasksForUser($scope.userID,function(data){$scope.pendingTasklist=data}),CommonData.getCompletedTasksForUser($scope.userName,function(data){$scope.completedTasklist=data})},$scope.showCompletedTasksVar=!1,$scope.showCompletedTasks=function(){$scope.showCompletedTasksVar=!$scope.showCompletedTasksVar},$scope.taskCompleted=function(id){CommonData.pendingToComplete(id),CommonData.removeFromPendingTasks(id,$routeParams.id),setTimeout(function(){$scope.refresh()},1e3)},$scope.refresh=function(){$scope.getTasks()}}]),mp4Controllers.controller("TaskController",["$scope","$window","CommonData","$http",function($scope,$window,CommonData,$http){function refresh(){CommonData.getTasks($scope.apc,$scope.sortby,$scope.order,$scope.offset,function(data){$scope.data=data}),0===$scope.offset?$scope.showPrevious=!1:$scope.showPrevious=!0}$scope.apc="",$scope.setAPC=function(param){$scope.apc=param,$scope.offset=0,refresh()},$scope.order="-1",$scope.setORDER=function(param){$scope.order=param,$scope.offset=0,refresh()},$scope.sortby="date_created",$scope.setSORTBY=function(param){$scope.sortby=param,$scope.offset=0,refresh()},$scope.data="",CommonData.getTasks($scope.apc,$scope.sortby,$scope.order,$scope.offset,function(data){$scope.data=data}),$scope.deleteTask=function(id){var userID="";CommonData.userIDFromTaskID(id,function(data){userID=data,CommonData.removeFromPendingTasks(id,userID),$scope["delete"](id),setTimeout(refresh(),1e3)}),setTimeout(refresh(),1e3)},$scope["delete"]=function(id){$http({method:"DELETE",url:$window.sessionStorage.baseurl+"/tasks/"+id}).then(function(response){console.log("Task Deleted!")},function(response){console.log("Error while deleting task!")}),setTimeout(refresh(),1e3)},$scope.showPrevious=!1,$scope.showNext=!0,$scope.offset=0,$scope.previous=function(){$scope.offset-=10,refresh()},$scope.next=function(){$scope.offset+=10,refresh()}}]),mp4Controllers.controller("addTaskController",["$scope","$http","$window","$routeParams","CommonData",function($scope,$http,$window,$routeParams,CommonData){$scope.taskname="",$scope.nameEmpty="",$scope.$watch("taskname",function(){""===$scope.taskname?$scope.nameEmpty=!0:$scope.nameEmpty=!1}),$scope.deadline="",$scope.deadlineEmpty="",$scope.$watch("deadline",function(){""===$scope.deadline?$scope.deadlineEmpty=!0:$scope.deadlineEmpty=!1}),$scope.description="",$scope.username="",$scope.showNewTaskDetails=!1,$scope.nuTaskname="",$scope.nuDescription="",$scope.nuDeadline="",$scope.nuUsername="",$scope.nuUserID="",$scope.nuID="",$scope.newTaskData="",$scope.tempID="",$scope.addNewTask=function(){console.log("addNewTask()"),""!==$scope.username?CommonData.idFromUserName($scope.username,function(data){$scope.nuUserID=data,console.log("addNewTask()::nuUserID: "+$scope.nuUserID),$scope.post()}):$scope.post()},$scope.post=function(){console.log("addNewTask()::HTTP POST REQUEST"),$http({method:"POST",url:$window.sessionStorage.baseurl+"/tasks",data:{name:$scope.taskname,description:$scope.description,assignedUserName:$scope.username,assignedUser:$scope.nuUserID,deadline:$scope.deadline}}).then(function(response){console.log("addNewTask():: HTTP SUCCESS"),$scope.newTaskData=response.data,console.log("addNewTask():: newTaskData"),console.log($scope.newTaskData),$scope.nuTaskname=$scope.newTaskData.data.name,$scope.nuDescription=$scope.newTaskData.data.description,$scope.nuDeadline=$scope.newTaskData.data.deadline,$scope.nuUsername=$scope.newTaskData.data.assignedUserName,$scope.nuID=$scope.newTaskData.data._id,$scope.showNewTaskDetails=!0,""!==$scope.nuUsername&&(console.log("addNewTask()::Adding newly created task to user:"+$scope.nuUsername),CommonData.addTaskToUser($scope.nuUsername,$scope.nuID))},function(response){console.log("addNewTask()::HTTP FAILURE: Error adding task!")}),$scope.taskname="",$scope.description="",$scope.deadline="",$scope.username=""},$scope.userList="",$scope.showDroptions=!1,$scope.showDropdown=function(){$scope.showDroptions=!$scope.showDroptions},CommonData.getUsers(function(data){$scope.userList=data}),$scope.changeUser=function(userName){$scope.username=userName,$scope.showDroptions=!1}}]),mp4Controllers.controller("taskDetailController",["$scope","$http","$window","$routeParams","CommonData",function($scope,$http,$window,$routeParams,CommonData){$scope.data="",$scope.name="",$scope.description="",$scope.assignedUserName="",$scope.assignedUser="",$scope.deadline="",$scope.completed="",$scope.dateCreated="",$scope.showEditName=!1,$scope.editName=function(){$scope.showEditName=!$scope.showEditName,$scope.showEditName===!1&&($scope.emptyName=!1)},$scope.showEditDescription=!1,$scope.editDescription=function(){$scope.showEditDescription=!$scope.showEditDescription},$scope.showEditUser=!1,$scope.editUser=function(){$scope.showEditUser=!$scope.showEditUser},$scope.showEditDeadline=!1,$scope.editDeadline=function(){$scope.showEditDeadline=!$scope.showEditDeadline,$scope.showEditDeadline===!1&&($scope.emptyDeadline=!1)},$scope.emptyName=!1,$scope.emptyDeadline=!1,$scope.nuData="",$scope.nuName="",$scope.nuDescription="",$scope.nuAssignedUserName="",$scope.nuAssignedUser="",$scope.nuDeadline="",$scope.nuCompleted="",CommonData.getSingleTask($routeParams.id,function(data){$scope.data=data,$scope.name=$scope.data.name,$scope.description=$scope.data.description,$scope.assignedUserName=$scope.data.assignedUserName,$scope.assignedUser=$scope.data.assignedUser,$scope.deadline=$scope.data.deadline,$scope.completed=$scope.data.completed,$scope.dateCreated=$scope.data.dateCreated}),$scope.changeUser=function(userName){$scope.showEditUser=!1;var currentUser=$scope.assignedUserName,newUser=userName,newUserID="";CommonData.idFromUserName(newUser,function(data){newUserID=data}),CommonData.removeFromPendingTasksName($routeParams.id,currentUser),CommonData.addTaskToUser(newUser,$routeParams.id),setTimeout(function(){CommonData.addUserToTask(newUser,newUserID,$routeParams.id),$scope.refresh()},1e3)},$scope.changeName=function(){return""===$scope.nuName?void($scope.emptyName=!0):($scope.data.name=$scope.nuName,void $http({method:"PUT",url:$window.sessionStorage.baseurl+"/tasks/"+$routeParams.id,data:$scope.data}).then(function(response){$scope.refresh(),$scope.showEditName=!1},function(response){}))},$scope.changeDescription=function(){$scope.data.description=$scope.nuDescription,$http({method:"PUT",url:$window.sessionStorage.baseurl+"/tasks/"+$routeParams.id,data:$scope.data}).then(function(response){$scope.refresh(),$scope.showEditDescription=!1},function(response){})},$scope.changeDeadline=function(){""===$scope.nuDeadline&&($scope.emptyDeadline=!0),$scope.data.deadline=$scope.nuDeadline,$http({method:"PUT",url:$window.sessionStorage.baseurl+"/tasks/"+$routeParams.id,data:$scope.data}).then(function(response){$scope.refresh(),$scope.showEditDeadline=!1},function(response){})},$scope.changeCompletion=function(){$scope.data.completed=!$scope.data.completed,$http({method:"PUT",url:$window.sessionStorage.baseurl+"/tasks/"+$routeParams.id,data:$scope.data}).then(function(response){$scope.refresh()},function(response){})},$scope.refresh=function(){setTimeout(function(){CommonData.getSingleTask($routeParams.id,function(data){$scope.data=data,$scope.name=$scope.data.name,$scope.description=$scope.data.description,$scope.assignedUserName=$scope.data.assignedUserName,$scope.assignedUser=$scope.data.assignedUser,$scope.deadline=$scope.data.deadline,$scope.completed=$scope.data.completed,$scope.dateCreated=$scope.data.dateCreated,$scope.emptyDeadline=!1,$scope.emptyName=!1})},1e3)},$scope.userList="",$scope.showDroptions=!1,$scope.showDropdown=function(){$scope.showDroptions=!$scope.showDroptions},CommonData.getUsers(function(data){$scope.userList=data})}]),mp4Controllers.controller("SettingsController",["$scope","$window",function($scope,$window){$scope.url=$window.sessionStorage.baseurl,$scope.setUrl=function(){$window.sessionStorage.baseurl=$scope.url,$scope.displayText="URL set"}}]);